<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class MalwareScanController extends Controller
{


    public function scan(Request $request)
    {
        $request->validate([
            "docker_container_id" => "required",
        ]);
        $outputs = [];
        return "docker container exec -it --user root $request->docker_container_id clamdscan / --remove";
        exec("docker container exec -it --user root $request->docker_container_id clamdscan / --remove", $outputs);
        $result = implode("\n", $outputs);
        $matches = [];
        preg_match_all("/(.+?): Removed./u", $result, $matches);
        if (count($matches) !== 2) {
            return json_encode([]);
        }
        $removedFiles = $matches[1];
        return json_encode($removedFiles);
    }
}
